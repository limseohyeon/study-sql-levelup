# 3강. DBMS와 실행 계획

## 데이터에 접근하는 방법이 결정되는 과정

![3강-1.png](/최주하/자료/3강-1.png)

### 파서

파서는 구문 분석한다. 사용자가 입력한 SQL 구문이 올바른지 검사하고, SQL 구문을 정형적인 형식으로 변환한다.
<br><br>
### 옵티마이저

파서를 통해 변환된 쿼리는 옵티마이저로 이동한다. 옵티마이저는 인덱스 유무, 데이터 분산 또는 편향 정도, DBMS 내부 매개변수 등의 조건을 고려하여 비용을 연산하고, 가장 낮은 비용을 가진 실행 계획을 선택한다.
<br><br>
### 카탈로그 매니저

옵티마이저가 실행계획을 세울 때, 옵티마이저에게 중요한 정보를 제공하는 것이 카탈로그 매니저이다.

> 📌 **카탈로그 :** DBMS의 내부 정보를 모아놓은 테이블들로, 테이블 또는 인덱스의 통계정보가 저장되어 있다.
> - 각 테이블의 레코드 수, 각 테이블의 필드 수와 필드의 크기, 필드의 카디널리티, 필드 값의 히스토그램, 필드 내부에 있는 NULL의 수, 인덱스 정보

<br><br>
### 플랜 평가

옵티마이저가 SQL 구문에서 여러 개의 실행 계획을 세운 뒤, 그것을 받아 최적의 실행 결과를 선택하는 것이 플랜 평가이다.

🤔 사실 이 부분에서 공부를 하며 많이 헷갈렸다. 분명 옵티마이저가 실행 계획을 자동으로 선택할 텐데, 책에서는 플랜평가라는 단계를 별도로 분리해 설명하고 있기 때문이었다.

→ 내가 이해한 바는 다음과 같다.

> 플랜 평가는 **옵티마이저 내부에서 자동으로 선택지 중 최적의 실행계획을 선택하는 과정**이기도 하고, 그 결과를 **DBA나 개발자가 검토 및 튜닝을 하는 과정**이기도 하다. 책에서 옵티마이저와 플랜 평가가 분리해 표현한 것은, **평가 주체의 차이**를 표현한 것 같다.

<br><br><br>
## 옵티마이저와 통계 정보

플랜 선택을 옵티마이저에게 맡기는 경우, 최적의 플랜이 선택되지 않는 경우가 많다. 이는 통계정보가 부족한 경우가 대표적인 원인으로 꼽힌다. **구식 정보를 바탕으로 플랜을 만들게 두지 말자!** 통계정보는 수동으로 갱신할 수도 있지만, 데이터를 크게 갱신하는 배치 처리가 있을 때는 Job Net을 조합하는 경우도 있다.

통계 정보 갱신은 실행 비용이 굉장히 높은 작업이지만, DBMS가 최적의 플랜을 선택하도록 하기 위해서는 **꼭!** 필요한 조건이다. 따라서 갱신 시점을 확실하게 검토해야 한다.

- 통계 정보 갱신 명령어

| **DBMS** | **명령어** |
| --- | --- |
| **Oracle** | exec DBMS_STATS.GATHER_TABLE_STATS(OWNNAME⇒[스키마 이름], TABNAME⇒[테이블 이름]); |
| **Microsoft SQL Server** | UPDATE STATISTICS [테이블 이름] |
| **DB2** | RUNSTATS ON TABLE [스키마 이름].[테이블 이름]; |
| **PostgreSQL** | ANALYZE [스키마 이름].[테이블 이름]; |
| **MySQL** | ANALYZE TABLE [스키마 이름].[테이블 이름]; |