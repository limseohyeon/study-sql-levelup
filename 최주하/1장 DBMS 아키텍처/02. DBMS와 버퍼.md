# 2강. DBMS와 버퍼
## DBMS와 기억장치

DBMS는 데이터 저장을 목적으로 하는 미들웨어이며, 기억장치와 떨어뜨릴 수 없는 관계이다. DBMS가 사용하는 대표적인 기억장치는 ***하드디스크(HDD)와 메모리***다.

- **하드디스크(HDD)**

DBMS가 데이터를 저장하는 저장소는 대부분 하드디스크이다. 하드디스크는 2차 기억장치에 분류되어 접근 속도와 기억 비용이 평균적인 수치를 가진다.

- **메모리**

메모리는 1차 기억장치에 분류되며, 접근속도가 굉장히 빠르다. 그러나, 기억비용도 높기 때문에 모든 데이터를 메모리에 저장할 수는 없다. 따라서, DBMS는 **일부 데이터만** 메모리에 올려 성능을 향상시킨다.
<br><br>
### 버퍼로 사용되는 메모리

자주 접근하는 데이터를 메모리에 올리면, 같은 SQL 구문을 실행해도 디스크가 아닌 메모리에 접근해서 빠르게 데이터를 검색할 수 있다. 디스크 접근의 감소는 성능 향상으로 이어진다. *일반적으로 SQL 구문의 실행 시간 대부분을 저장소 I/O 입출력에 사용하기 때문이다.*

이렇게 성능 향상을 목적으로 데이터를 저장하는 메모리를 **버퍼 또는 캐시**라고 부른다. DBMS의 버퍼 매니저가 *버퍼에 데이터를 어떻게, 어느정도의 기간 동안 올릴지*를 관리한다.
<br><br>
### 두 개의 버퍼

DBMS에는 ***데이터 캐시***와 ***로그 버퍼***의 역할을 하는 메모리 영역을 가지고 있다. 사용자는 용도에 따라 크기를 변경할 수 있다.

- **데이터 캐시 → 검색**

  데이터 캐시는 디스크에 있는 데이터의 일부를 메모리에 유지하기 위해 사용하는 메모리 영역이다.

- **로그 버퍼 → 갱신**

  DBMS는 갱신과 관련된 SQL 구문을 사용자로부터 받고, 바로 저장소에 있는 데이터를 변경하지 않는다. 일단, *로그 버퍼에 변경 정보를 보내고 이후 디스크에 변경을 수행한다.* 데이터베이스의 갱신처리는 SQL 구문의 실행 시점과 저장소 갱신 시점에 차이가 있는 **비동기 처리**다.

<br><br>
> 📎 **DBMS는 갱신 처리를 왜 비동기로 할까?**
>

갱신할 때 , 시간 소모가 많이 되기 때문에 저장소 변경이 끝날 때 까지 기다려야 한다면, 사용자는 장시간 대기하게 된다. 따라서 메모리에 갱신 정보를 받은 시점에 사용자에게 해당 SQL 구문이 끝났다고 통지하고, 내부적으로 관련된 처리를 계속 수행하게 된다. → **성능 향상**을 위해서! 비동기 처리를 한다.
<br><br>
### 메모리 성질이 초래하는 트레이드 오프

메모리의 특징 중 하나는 **휘발성**이다. 따라서 DBMS를 껐다 켜면 메모리에 있던 모든 데이터가 사라진다.

- **휘발성의 문제점**

데이터 캐시의 경우, 장애로 인해 메모리 위의 데이터가 사라져도, 디스크에서 원본 데이터를 읽어오면 되기 때문에 문제가 없다.

그러나, 로그버퍼의 경우는 다르다. DBMS는 로그 버퍼에 변경 정보를 저장해두고, 이후 디스크에 존재하는 원본데이터를 변경한다. 장애가 발생하면, 변경 사항이 완전히 사라져서 복구가 불가능해져서 데이터 부정합을 발생시킨다. 따라서 휘발성이라는 특징은 **로그 버퍼**에 치명적이다.

- **성능과 데이터 정합성**

로그 파일에 전달된 갱신 정보가 DBMS가 다운될 때 사라지는 현상은 DBMS가 갱신을 비동기로 하는 이상, 언제든 발생할 수 있는 문제이다. 따라서 이를 회피하고자 **DBMS는 커밋 시점에 반드시 갱신 정보를 로그파일에 씀**으로써, **장애가 발생해도 정합성을 유지**할 수 있도록 한다. 커밋 때는 반드시 디스크에 동기 접근이 일어나는데, 이 때 지연 발생 가능성이 있다. → **성능과 데이터 정합성 간**의 트레이드 오프가 발생한다.
<br><br>
### 시스템 특성에 따른 트레이드 오프

- **데이터 캐시와 로그 버퍼의 크기**

메모리는 기억비용이 높다. 따라서 자원이 한정되어 있기 때문에 메모리 크기를 어떻게 배분하는지도 성능에 영향을 미친다. 기본적으로 DBMS는 데이터 캐시에 더 많은 크기의 메모리 영역을 할당한다. 이는 데이터베이스가 기본적으로 검색을 메인으로 처리한다고 가정하기 때문이다. 그러나, 시스템의 특성에 따라서 갱신이 많다면, 로그 버퍼를 늘려 최적화를 진행할 수 있다.

✅데이터 캐시(검색), 로그버퍼(갱신)
<br><br>
### 워킹 메모리

- **워킹 메모리 개념**

  DBMS에서 버퍼 이외의 추가적인 메모리 영역이 있는데, 이를 워킹 메모리라고 부른다. 워킹 메모리는 **정렬, 해시** 관련 처리에서 사용되는 작업용 영역이다. 이 메모리는 작업이 종료되는 해제되는 임시 영역이다.

- **워킹 메모리가 부족하다면?**

  워킹 메모리가 부족하면 임시적인 영역을 사용하게 되는데, 임시적으로 사용하는 영역은 느린 속도의 **디스크**를 사용하기 때문에 성능에 영향을 미친다.

<br><br>
> **✅메모리 정리**

**데이터 캐시** : 자주 사용되는 데이터는 데이터 캐시에 적재한다. 검색 시 성능 향상을 위해 사용된다.

**로그 버퍼** : 변경 요청이 들어오면 로그 버퍼에 저장해둔 뒤, 디스크의 데이터를 변경한다. 갱신 시 성능 향상을 위해 사용한다.

**워킹 메모리** : 정렬이나 해시 관련 처리에서 사용되는 작업용 메모리 영역이다.
